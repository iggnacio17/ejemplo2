<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üé• Gestor de Videos</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #1e1e1e;
      color: #ffffff;
      margin: 0;
      display: flex;
    }
    aside {
      width: 200px;
      background: #2c2c2c;
      padding: 20px 10px;
      height: 100vh;
    }
    aside h1 {
      font-size: 18px;
      text-align: center;
      margin-bottom: 20px;
    }
    aside button {
      width: 100%;
      margin: 5px 0;
      padding: 10px;
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }
    aside button:hover {
      background-color: #45a049;
    }
    main { flex: 1; padding: 20px; }
    .filtros {
      margin-bottom: 20px;
    }
    .filtros input, .filtros select {
      width: 90%;
      max-width: 400px;
      margin: 5px 0;
      padding: 8px;
      border-radius: 4px;
      border: none;
    }
    .tab { display: none; }
    .tab.active { display: block; }
    .galeria {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }
    .video-card, .short-card {
      background: #3a3a3a;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      height: 100%;
    }
    .video-card img, .short-card img {
      width: 100%;
      height: auto;
      max-height: 300px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
    }
    .video-name {
      font-weight: bold;
      font-size: 16px;
      margin-top: 8px;
    }
    .video-card p {
      font-size: 13px;
      margin: 6px 0;
    }
    .acciones span {
      margin: 0 5px;
      cursor: pointer;
      font-size: 18px;
    }
    .formulario input, .formulario select, .formulario button {
      display: block;
      margin: 8px 0;
      width: 90%;
      max-width: 400px;
      padding: 8px;
    }
    .formulario {
      background: #2c2c2c;
      padding: 20px;
      border-radius: 10px;
    }
    .tag {
      background-color: #555;
      border-radius: 5px;
      padding: 2px 6px;
      margin: 2px;
      display: inline-block;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <aside>
    <h1>üé• Videos</h1>
    <button onclick="mostrarTab('galeriaTab')">Galer√≠a</button>
    <button onclick="mostrarTab('formularioTab')">Nuevo Video</button>
    <button onclick="mostrarTab('shortsTab')">Nuevo Short</button>
    <button onclick="mostrarTab('favoritosTab')">‚≠ê Favoritos</button>
    <button onclick="exportarBaseDatos()">‚¨áÔ∏è Exportar</button>
    <button onclick="document.getElementById('importInput').click()">‚¨ÜÔ∏è Importar</button>
    <input type="file" id="importInput" accept=".json" style="display: none" onchange="importarBaseDatos(event)">
  </aside>
  <main>
    <div class="tab active" id="galeriaTab">
      <div class="filtros">
        <input type="text" id="buscador" placeholder="Buscar por nombre, actriz o categor√≠a" oninput="filtrarVideos()">
        <select id="categoriaFiltro" onchange="filtrarVideos()">
          <option value="">üìÇ Todas las categor√≠as</option>
        </select>
      </div>
      <div class="galeria" id="galeria"></div>
    </div>
    <div class="tab" id="formularioTab">
      <div class="formulario">
        <input type="text" id="videoUrl" placeholder="Enlace del video">
        <input type="text" id="imageUrl" placeholder="Enlace de la imagen">
        <input type="text" id="videoNombre" placeholder="Nombre del video">
        <input type="text" id="nuevaActriz" placeholder="Agregar actrices (separadas por comas)">
        <select id="actrizSelect" multiple></select>
        <input type="text" id="nuevaCategoria" placeholder="Agregar categor√≠as (separadas por comas)">
        <select id="categoriaSelect" multiple></select>
        <input type="text" id="nuevaCarpeta" placeholder="Nueva carpeta">
        <select id="carpetaSelect"></select>
        <button onclick="guardarVideo()">Guardar Video</button>
      </div>
    </div>
    <div class="tab" id="shortsTab">
      <div class="formulario">
        <input type="text" id="shortUrl" placeholder="Enlace del short">
        <input type="text" id="shortImageUrl" placeholder="Enlace de la imagen">
        <button onclick="guardarShort()">Guardar Short</button>
      </div>
      <div class="galeria" id="galeriaShorts" style="margin-top: 20px;"></div>
    </div>
    <div class="tab" id="favoritosTab">
      <div class="galeria" id="galeriaFavoritos"></div>
    </div>
  </main>
  <script>
    const PASSWORD = "finnCracK12@";
    const videosKey = 'videos';
    const shortsKey = 'shorts';
    const actoresKey = 'actrices';
    const categoriasKey = 'categorias';
    const carpetasKey = 'carpetas';
    const favoritosKey = 'favoritos';
    const favoritosShortsKey = 'favoritosShorts';

    const galeria = document.getElementById('galeria');
    const galeriaShorts = document.getElementById('galeriaShorts');
    const buscador = document.getElementById('buscador');
    const categoriaFiltro = document.getElementById('categoriaFiltro');

    function mostrarTab(id) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      if (id === "galeriaTab") cargarDatos();
      else if (id === "shortsTab") cargarShorts();
      else if (id === "favoritosTab") cargarFavoritos();
    }

    function getData(key) {
      try {
        const data = JSON.parse(localStorage.getItem(key));
        return Array.isArray(data) ? data : [];
      } catch {
        return [];
      }
    }

    function setData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    function actualizarSelect(select, data, incluirTodas = false) {
      select.innerHTML = '';
      if (incluirTodas) {
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = 'üìÇ Todas las categor√≠as';
        select.appendChild(opt);
      }
      data.forEach(item => {
        const option = document.createElement('option');
        option.value = item;
        option.textContent = item;
        select.appendChild(option);
      });
    }

    function esArraySeguro(campo) {
      if (Array.isArray(campo)) return campo;
      if (typeof campo === 'string') return campo.split(',').map(s => s.trim()).filter(Boolean);
      return [];
    }

    function crearCard(video, favoritos) {
      const card = document.createElement('div');
      card.className = 'video-card';
      const img = document.createElement('img');
      img.src = video.imageUrl;
      img.onclick = () => { copiarEnlace(video.videoUrl); window.open(video.videoUrl, '_blank'); };
      const nombre = document.createElement('div');
      nombre.className = 'video-name';
      nombre.textContent = video.videoNombre;
      const etiquetas = document.createElement('p');
      esArraySeguro(video.actrices).forEach(actriz => {
        const tag = document.createElement('span');
        tag.className = 'tag';
        tag.textContent = actriz;
        tag.onclick = () => { buscador.value = actriz; filtrarVideos(); };
        etiquetas.appendChild(tag);
      });
      esArraySeguro(video.categorias).forEach(cat => {
        const tag = document.createElement('span');
        tag.className = 'tag';
        tag.textContent = cat;
        tag.onclick = () => { buscador.value = cat; filtrarVideos(); };
        etiquetas.appendChild(tag);
      });
      const carpeta = document.createElement('p');
      carpeta.textContent = `üìÅ ${video.carpeta}`;
      const acciones = document.createElement('div');
      acciones.className = 'acciones';
      const star = document.createElement('span');
      star.textContent = favoritos.includes(video.videoUrl) ? '‚≠ê' : '‚òÜ';
      star.onclick = () => toggleFavorito(video.videoUrl);
      const copy = document.createElement('span');
      copy.textContent = 'üìã';
      copy.onclick = () => copiarEnlace(video.videoUrl);
      const trash = document.createElement('span');
      trash.textContent = 'üóëÔ∏è';
      trash.onclick = () => eliminarVideo(video.videoUrl);
      acciones.append(star, copy, trash);
      card.append(img, nombre, etiquetas, carpeta, acciones);
      return card;
    }

    function cargarVideos() {
      const videos = getData(videosKey);
      const favoritos = getData(favoritosKey);
      const filtroCategoria = categoriaFiltro.value;
      const query = buscador.value.toLowerCase();
      let mostrar = videos.filter(video => {
        const actrices = esArraySeguro(video.actrices);
        const categorias = esArraySeguro(video.categorias);
        return video.videoNombre.toLowerCase().includes(query) ||
          actrices.some(a => a.toLowerCase().includes(query)) ||
          categorias.some(c => c.toLowerCase().includes(query));
      });
      if (filtroCategoria !== "") mostrar = mostrar.filter(v => esArraySeguro(v.categorias).includes(filtroCategoria));
      galeria.innerHTML = '';
      mostrar.forEach(video => galeria.appendChild(crearCard(video, favoritos)));
    }

    function filtrarVideos() { cargarVideos(); }

    function cargarDatos() {
      actualizarSelect(document.getElementById('actrizSelect'), getData(actoresKey));
      actualizarSelect(document.getElementById('categoriaSelect'), getData(categoriasKey));
      actualizarSelect(document.getElementById('carpetaSelect'), getData(carpetasKey));
      actualizarSelect(categoriaFiltro, getData(categoriasKey), true);
      cargarVideos();
    }

    function copiarEnlace(videoUrl) {
      navigator.clipboard.writeText(videoUrl);
    }

    function toggleFavorito(videoUrl) {
      let favoritos = getData(favoritosKey);
      if (favoritos.includes(videoUrl)) favoritos = favoritos.filter(url => url !== videoUrl);
      else favoritos.push(videoUrl);
      setData(favoritosKey, favoritos);
      cargarVideos();
    }

    function eliminarVideo(videoUrl) {
      let lista = getData(videosKey).filter(video => video.videoUrl !== videoUrl);
      setData(videosKey, lista);
      cargarVideos();
    }

    function pedirContrasena() {
      const input = prompt("Introduce la contrase√±a:");
      if (input !== PASSWORD) {
        alert("Contrase√±a incorrecta. Acceso denegado.");
        document.body.innerHTML = "<h1 style='color: red; text-align:center;'>Acceso Denegado</h1>";
      } else {
        cargarDatos();
      }
    }

    pedirContrasena();
  </script>
</body>
</html>
